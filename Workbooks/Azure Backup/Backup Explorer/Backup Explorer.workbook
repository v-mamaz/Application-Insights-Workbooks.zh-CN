{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 11,
            "content": {
                "version": "LinkItem/1.0",
                "style": "tabs",
                "links": [
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Overview",
                        "subTarget": "Overview",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Summary",
                        "subTarget": "Summary",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Backup Items",
                        "subTarget": "Backup Items",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Backup Policies",
                        "subTarget": "Backup Policies",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Backup Jobs",
                        "subTarget": "Backup Jobs",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Backup Alerts",
                        "subTarget": "Backup Alerts",
                        "style": "link"
                    },
                    {
                        "cellValue": "Tabname",
                        "linkTarget": "parameter",
                        "linkLabel": "Not Protected",
                        "subTarget": "Not Protected",
                        "style": "link"
                    }
                ]
            },
            "name": "links - 23"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style=\"text-align:left;float:left;\"><span data-ttu-id=\"2fa04-101\"><span style=\"font-size:16px;font-weight:600\">备份资源管理器（虚拟机）- {Tabname} </span></span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-101\"><span style=\"font-size:16px;font-weight:600\">Backup Explorer (Virtual Machines) - {Tabname} </span></span></span></div> <div style=\"text-align:right;float:right\"><span data-ttu-id=\"2fa04-102\"><span style=\"font-size:12px;\"><a href=\"#\">如何使用备份资源管理器？</a></span></span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-102\"><span style=\"font-size:12px;\"><a href=\"#\">How to use backup explorer?</a></span></span></span></div>"
            },
            "name": "text - 15"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "8c4ae44c-fa9a-4498-aedc-736a56e64b43",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "description": "<span data-ttu-id=\"2fa04-103\">选择“时间范围”以查看作业和警报</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-103\">Select Time Range to view Jobs and Alerts</span></span>",
                        "isRequired": true,
                        "value": {
                            "durationMs": 86400000
                        },
                        "typeSettings": {
                            "selectableValues": [
                                {
                                    "durationMs": 86400000
                                },
                                {
                                    "durationMs": 172800000
                                },
                                {
                                    "durationMs": 259200000
                                },
                                {
                                    "durationMs": 604800000
                                }
                            ],
                            "allowCustom": false
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "8a19264d-e7e9-4a23-8c3a-128bda8340f7",
                        "version": "KqlParameterItem/1.0",
                        "name": "Subscriptions",
                        "type": 6,
                        "description": "<span data-ttu-id=\"2fa04-104\">从“默认订阅”列表中选择</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-104\">Select from list of Default Subscriptions</span></span>",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "value": [
                            "value::all"
                        ],
                        "typeSettings": {
                            "additionalResourceOptions": [
                                "value::all"
                            ],
                            "includeAll": false
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "eb783656-4dd4-4973-a090-eea8cf20fb42",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemHostHash",
                        "type": 1,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| project x = tostring(hash(strcat(tolower(subscriptionId), tolower(tostring(split(tostring(properties.containerName), \";\")[1])), tolower(tostring(split(tostring(properties.containerName), \";\")[2])))))\r\n| distinct x\r\n| summarize x = tostring(makelist(x,32000))\r\n| project x = replace(\"[\\\\]\\\\[]\",\"\",x)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "2fea6948-d21b-478f-9a4a-d58b5e30e14f",
                        "version": "KqlParameterItem/1.0",
                        "name": "VMHash",
                        "type": 1,
                        "isRequired": true,
                        "query": "Resources\r\n| where type == \"microsoft.compute/virtualmachines\" or type == \"microsoft.classiccompute/virtualmachines\"\r\n| project x = tolower(subscriptionId), y = tolower(resourceGroup), z = tolower(name)\r\n| project a = tostring(hash(strcat(x,y,z)))\r\n| where a in ({BackupItemHostHash})\r\n| summarize a = makelist(a,32000)\r\n| project a = replace(\"[\\\\]\\\\[]\",\"\",tostring(a))",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "customWidth": "0",
            "name": "parameters - 7"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "2a83acc5-2123-476f-8a4c-da2fddf231a1",
                        "version": "KqlParameterItem/1.0",
                        "name": "Location",
                        "label": "Vault Location",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-105\">选择一个或多个具有恢复服务保管库的位置</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-105\">Select one or more locations having recovery services vaults</span></span>",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| summarize by location",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": [
                            "value::all"
                        ],
                        "typeSettings": {
                            "additionalResourceOptions": [
                                "value::all"
                            ],
                            "selectAllValue": "*"
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "fefd31fa-2774-43ca-8cc3-44d477c969f0",
                        "version": "KqlParameterItem/1.0",
                        "name": "Vault",
                        "type": 5,
                        "description": "<span data-ttu-id=\"2fa04-106\">选择一个或多个恢复服务保管库</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-106\">Select one or more recovery services vaults</span></span>",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| where location in ({Location}) or '*' in ({Location})\r\n| summarize by id = tolower(id)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": [
                            "value::all"
                        ],
                        "typeSettings": {
                            "additionalResourceOptions": [
                                "value::all"
                            ],
                            "selectAllValue": "*"
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "e10a33af-55df-48ee-ac20-57f70436964c",
                        "version": "KqlParameterItem/1.0",
                        "name": "AllVaultHash",
                        "type": 1,
                        "isRequired": true,
                        "query": "Resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| where location in ({Location}) or '*' in ({Location})\r\n| summarize by id = tolower(id)\r\n| summarize x = makelist(tostring(hash(id)),32000)\r\n| project a = replace(\"[\\\\]\\\\[]\",\"\",tostring(x))",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isNotEqualTo",
                "value": "Not Protected"
            },
            "customWidth": "0",
            "name": "parameters - 7 - Copy"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "60a7f6fb-86ec-4e68-ac3e-d5f83419cc09",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemView",
                        "label": "Choose Backup Item View",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-107\">增强的视图提供更多可供用户与之交互的筛选器和列</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-107\">Enhanced view provides more filters and columns to interact</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"Standard\", \"label\":\"Standard\", \"selected\":true  },\r\n    { \"value\":\"Enhanced\", \"label\":\"Enhanced\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Items"
            },
            "customWidth": "0",
            "name": "parameters - 17"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "60a7f6fb-86ec-4e68-ac3e-d5f83419cc09",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyView",
                        "label": "Choose Policy View",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-108\">增强的视图提供更多可交互的筛选器和列，可用于查看与所选策略相关的备份项</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-108\">Enhanced view provides more filters and columns to interact and view Backup Items related to selected policy</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"Standard\", \"label\":\"Standard\", \"selected\":true  },\r\n    { \"value\":\"Enhanced\", \"label\":\"Enhanced\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "customWidth": "0",
            "name": "parameters - 17 - Copy"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "60a7f6fb-86ec-4e68-ac3e-d5f83419cc09",
                        "version": "KqlParameterItem/1.0",
                        "name": "RowsPerPage",
                        "label": "Rows Per Page",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-109\">要在网格视图中显示的行数</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-109\">Number of rows to display in grid view</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isNotEqualTo",
                    "value": "Overview"
                },
                {
                    "parameterName": "Tabname",
                    "comparison": "isNotEqualTo",
                    "value": "Summary"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isNotEqualTo",
                "value": "Overview"
            },
            "customWidth": "0",
            "name": "parameters - 17 - Copy"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style=\"text-align:left;float:left;\"><span style=\"font-size:14px;font-weight:600\">&nbsp;</span></div> <div style=\"text-align:right;float:right\"><span style=\"font-size:12px;\"></span></div>"
            },
            "name": "text - 15 - Copy - Copy"
        },
        {
            "type": 1,
            "content": {
                "json": "<span data-ttu-id=\"2fa04-110\">会将一个介绍性文本创建为 markdown</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-110\">Will create an introduction text as a markdown</span></span>"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Overview"
            },
            "name": "text - 16"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend BackupItems = \"Backup Items\", SubText = \"Total\"\r\n| summarize c = count() by BackupItems, SubText\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "BackupItems",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 17 - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "Resources\r\n| where type in (\"microsoft.compute/virtualmachines\", \"microsoft.classiccompute/virtualmachines\")\r\n| where tostring(hash(strcat(tolower(subscriptionId), tolower(resourceGroup), tolower(name)))) !in ({BackupItemHostHash})\r\n| project id, NotProtected = \"Not Protected\", VirtualMachines = \"Virtual Machines\"\r\n| summarize c = count() by NotProtected, VirtualMachines",
                "size": 4,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "NotProtected",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "VirtualMachines",
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 17"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| where properties.status != \"InProgress\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend BackupJobs = \"Backup Jobs\", SubText = \"Total\"\r\n| summarize c = count() by BackupJobs, SubText\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "BackupJobs",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend BackupAlerts = \"Backup Alerts\", SubText = \"Total\"\r\n| summarize c = count() by BackupAlerts, SubText\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "BackupAlerts",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24 - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| summarize BackupItems = count() by ProtectionState = tostring(properties.protectionState)\r\n| sort by ProtectionState asc",
                "size": 4,
                "exportDefaultValue": "*",
                "exportToExcelOptions": "visible",
                "title": "Backup Items by Protection State",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "vaultId",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ]
                },
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "ProtectionState",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true,
                            "workbookContext": null
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "ResourceState",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "BackupItems",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true,
                            "workbookContext": null
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 10"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend a = tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2]))))\r\n| extend ResourceState = iff(a in ({VMHash}), \"Backup Items VM Active\", \"Backup Items VM Not Found\")\r\n| summarize BackupItems = count() by ResourceState\r\n| sort by ResourceState asc",
                "size": 4,
                "exportDefaultValue": "*",
                "exportToExcelOptions": "visible",
                "title": "Backup Items by Resource State",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "vaultId",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ]
                },
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "ProtectionState",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true,
                            "workbookContext": null
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "ResourceState",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "BackupItems",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true,
                            "workbookContext": null
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 10 - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| where properties.status != \"InProgress\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend SubText = \"Jobs\"\r\n| summarize c=count() by status = tostring(properties.status)\r\n| sort by status asc\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "title": "Jobs by Status",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "status",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24 - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| where properties.status != \"InProgress\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend SubText = \"Jobs\"\r\n| summarize c=count() by operation = tostring(properties.operation)\r\n| sort by operation asc\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "title": "Jobs by Operation",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "status",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24 - Copy - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend SubText = \"Alerts\", severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\"))\r\n| summarize c=count() by severity\r\n| sort by severity\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "title": "Alerts by Severity",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "severity",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24 - Copy - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend SubText = \"Alerts\", severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\"))\r\n| summarize c=count() by AlertName = tostring(properties.alertTitle)\r\n| sort by AlertName\r\n",
                "size": 4,
                "exportToExcelOptions": "visible",
                "title": "Alerts by Alertname",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "piechart",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "severity",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubText",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": true
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Summary"
            },
            "customWidth": "0",
            "name": "query - 24 - Copy - Copy - Copy"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemName",
                        "label": "Search Item or RG",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-111\">用于通过资源组和/或名称进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-111\">Use to filter using resource group and/or name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "db5ab575-14f6-44d0-bbb9-71c59d0d86b2",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyName",
                        "label": "Search Vault or Policy",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-112\">使用按保管库和/或策略名进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-112\">Use to filter by vault and/or policy name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "ProtectionState",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Protected\", \"label\":\"Protected\" },\r\n    { \"value\":\"ProtectionStopped\", \"label\":\"ProtectionStopped\" },\r\n    { \"value\":\"IRPending\", \"label\":\"IRPending\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ad30973f-5071-4ce4-9f2b-df9a93955879",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResourceState",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"VM Active\", \"label\":\"VM Active\" },\r\n    { \"value\":\"VM Not Found\", \"label\":\"VM Not Found\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "4c20879b-cb6e-4c9c-8923-0af5a1c063bd",
                        "version": "KqlParameterItem/1.0",
                        "name": "InDeferredDelete",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Yes\", \"label\":\"Yes\" },\r\n    { \"value\":\"No\", \"label\":\"No\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2a76174a-d5a5-41bb-99d2-9d2fce0e3167",
                        "version": "KqlParameterItem/1.0",
                        "name": "HealthCheck",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Passed\", \"label\":\"Passed\" },\r\n    { \"value\":\"ActionRequired\", \"label\":\"ActionRequired\" },\r\n    { \"value\":\"ActionSuggested\", \"label\":\"ActionSuggested\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ee5b73b4-8354-47fa-b98f-e4bd20332298",
                        "version": "KqlParameterItem/1.0",
                        "name": "LastBackup",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Completed\", \"label\":\"Completed\" },\r\n    { \"value\":\"CompletedWithWarnings\", \"label\":\"CompletedWithWarnings\" },\r\n    { \"value\":\"Failed\", \"label\":\"Failed\" },\r\n    { \"value\":\"Unknown\", \"label\":\"Unknown\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "dd894ccd-2ec7-456b-941a-f3ca616ad9e3",
                        "version": "KqlParameterItem/1.0",
                        "name": "MinDailyRetention",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-113\">指定每日备份的内容在保管库中保留的最少天数。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-113\">Specify minimum number of days the daily backup is retained in the vault.</span></span> <span data-ttu-id=\"2fa04-114\">使用零来查看未设置日常保留的行。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-114\">Use zero to view rows with no daily retention.</span></span>",
                        "isRequired": true,
                        "value": "0",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "1fc96995-297e-476d-8964-83b0d0e3687c",
                        "version": "KqlParameterItem/1.0",
                        "name": "MaxDailyRetention",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-115\">指定每日备份的内容在保管库中保留的最多天数</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-115\">Specify maximum number of days the daily backup is retained in the vault</span></span>",
                        "isRequired": true,
                        "value": "3650",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "1d767e68-5daf-4741-afa5-1dd017d68ba2",
                        "version": "KqlParameterItem/1.0",
                        "name": "SnapshotRetention",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-116\">为实现按天数进行筛选的功能，保留了备份快照以实现快速还原。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-116\">To filter by number of days the backup snapshot is retained for fast restores.</span></span> <span data-ttu-id=\"2fa04-117\">使用零来查看未设置快照保留的行。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-117\">Use zero to view rows with no snapshot retention.</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"0\", \"label\":\"0\" },\r\n    { \"value\":\"1\", \"label\":\"1\" },\r\n    { \"value\":\"2\", \"label\":\"2\" },\r\n    { \"value\":\"3\", \"label\":\"3\" },\r\n    { \"value\":\"4\", \"label\":\"4\" },\r\n    { \"value\":\"5\", \"label\":\"5\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend ResourceState = iff(tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2])))) in ({VMHash}), \"VM Active\", \"VM Not Found\")\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.containerName))),\r\n          ProtectionState = tostring(properties.protectionState),\r\n          ResourceState,\r\n\t\t  InDeferredDelete = iff(tostring(properties.isScheduledForDeferredDelete) == \"true\", \"Yes\", \"No\"),\r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id),\r\n          VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  PolicyName = tostring(properties.policyName),\r\n\t\t  deferredDeleteTimeInUTC = properties.deferredDeleteTimeInUTC, \r\n\t\t  deferredDeleteTimeRemaining = properties.deferredDeleteTimeRemaining, \r\n\t\t  healthDetails = properties.healthDetails\r\n| where Name contains (@\"{BackupItemName}\") \r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where ProtectionState == \"{ProtectionState}\" or strcat(ProtectionState,\"{ProtectionState}\") contains \"All\"\r\n| where ResourceState == \"{ResourceState}\" or strcat(ResourceState,\"{ResourceState}\") contains \"All\"\r\n| where InDeferredDelete == \"{InDeferredDelete}\" or strcat(InDeferredDelete,\"{InDeferredDelete}\") contains \"All\"\r\n| where HealthCheck == \"{HealthCheck}\" or strcat(HealthCheck,\"{HealthCheck}\") contains \"All\"\r\n| where LastBackup == \"{LastBackup}\" or strcat(LastBackup,\"{LastBackup}\") contains \"All\"\r\n| join kind = leftouter (\r\n\tRecoveryServicesResources\r\n\t| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n\t| extend policyId = tolower(id)\r\n\t| project policyId, DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n\t          InstantRpRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)), \"2\", tostring(properties.instantRpRetentionRangeInDays)), schedulePolicy = properties.schedulePolicy, retentionPolicy = properties.retentionPolicy \r\n) on policyId\r\n| project backupItemId,\r\n\t\t  Name,\r\n          ProtectionState,\r\n          ResourceState,\r\n\t\t  InDeferredDelete,\r\n\t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = format_datetime(todatetime(LastBackupTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n          LastRecoveryPoint = format_datetime(todatetime(LastRecoveryPoint),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  backupItemHostId,\r\n\t\t  Host,\r\n\t\t  PolicyName,\r\n\t\t  DailyRetention,\r\n\t\t  InstantRpRetention,\r\n\t\t  vaultId,\r\n\t\t  Info = \"Details\",\r\n\t\t  InfoDetails = pack(\"deferredDeleteTimeInUTC\",deferredDeleteTimeInUTC,\"deferredDeleteTimeRemaining\",deferredDeleteTimeRemaining,\"healthDetails\",healthDetails,\"schedulePolicy\",schedulePolicy,\"retentionPolicy\",retentionPolicy,\"InstantRpRetentionInDays\",tolong(InstantRpRetention))\r\n| where (tolong(DailyRetention) >= {MinDailyRetention} and tolong(DailyRetention) <= {MaxDailyRetention}) or (isempty(DailyRetention) and tolong({MinDailyRetention}) <= 0)\r\n| where InstantRpRetention == \"{SnapshotRetention}\" or strcat(InstantRpRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(InstantRpRetention) and strcat(InstantRpRetention,\"{SnapshotRetention}\") contains \"0\") \r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Items"
                },
                {
                    "parameterName": "BackupItemView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Items"
            },
            "customWidth": "100",
            "name": "parameters - 7",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend ResourceState = iff(tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2])))) in ({VMHash}), \"VM Active\", \"VM Not Found\")\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.containerName))),\r\n          ProtectionState = tostring(properties.protectionState),\r\n          ResourceState,\r\n\t\t  InDeferredDelete = iff(tostring(properties.isScheduledForDeferredDelete) == \"true\", \"Yes\", \"No\"),\r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id),\r\n          VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  PolicyName = tostring(properties.policyName),\r\n\t\t  deferredDeleteTimeInUTC = properties.deferredDeleteTimeInUTC, \r\n\t\t  deferredDeleteTimeRemaining = properties.deferredDeleteTimeRemaining, \r\n\t\t  healthDetails = properties.healthDetails\r\n| where Name contains (@\"{BackupItemName}\") \r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where ProtectionState == \"{ProtectionState}\" or strcat(ProtectionState,\"{ProtectionState}\") contains \"All\"\r\n| where ResourceState == \"{ResourceState}\" or strcat(ResourceState,\"{ResourceState}\") contains \"All\"\r\n| where InDeferredDelete == \"{InDeferredDelete}\" or strcat(InDeferredDelete,\"{InDeferredDelete}\") contains \"All\"\r\n| where HealthCheck == \"{HealthCheck}\" or strcat(HealthCheck,\"{HealthCheck}\") contains \"All\"\r\n| where LastBackup == \"{LastBackup}\" or strcat(LastBackup,\"{LastBackup}\") contains \"All\"\r\n| join kind = leftouter (\r\n\tRecoveryServicesResources\r\n\t| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n\t| extend policyId = tolower(id)\r\n\t| project policyId, DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n\t          InstantRpRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)), \"2\", tostring(properties.instantRpRetentionRangeInDays)), schedulePolicy = properties.schedulePolicy, retentionPolicy = properties.retentionPolicy \r\n) on policyId\r\n| project backupItemId,\r\n\t\t  Name,\r\n          Item = tostring(split(Name,\";\")[1]),\r\n          ResourceGroup = tostring(split(Name,\";\")[0]),\r\n          ProtectionState,\r\n          ResourceState,\r\n\t\t  InDeferredDelete,\r\n\t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = format_datetime(todatetime(LastBackupTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n          LastRecoveryPoint = format_datetime(todatetime(LastRecoveryPoint),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  Host = iff(ResourceState == \"VM Active\",backupItemHostId,\"\"),\r\n\t\t  DailyRetention,\r\n\t\t  InstantRpRetention,\r\n\t\t  PolicyName,\r\n\t\t  vaultId,\r\n\t\t  Info = \"Details\",\r\n\t\t  InfoDetails = pack(\"deferredDeleteTimeInUTC\",deferredDeleteTimeInUTC,\"deferredDeleteTimeRemaining\",deferredDeleteTimeRemaining,\"healthDetails\",healthDetails,\"schedulePolicy\",schedulePolicy,\"retentionPolicy\",retentionPolicy,\"InstantRpRetentionInDays\",tolong(InstantRpRetention))\r\n| where (tolong(DailyRetention) >= {MinDailyRetention} and tolong(DailyRetention) <= {MaxDailyRetention}) or (isempty(DailyRetention) and tolong({MinDailyRetention}) <= 0)\r\n| where InstantRpRetention == \"{SnapshotRetention}\" or strcat(InstantRpRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(InstantRpRetention) and strcat(InstantRpRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| sort by backupItemId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{BackupItemPageNumber}') or '*' in ('{BackupItemPageNumber}')\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "backupItemId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Name",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Item",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "backupItemId",
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceGroup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ProtectionState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "InDeferredDelete",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "HealthCheck",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackupTime",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastRecoveryPoint",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Host",
                            "formatter": 13,
                            "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "DailyRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "InstantRpRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "PolicyName",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Info",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "InfoDetails",
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": true,
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "InfoDetails",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "backupItemHostId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "backupItemId",
                            "label": "backupItemId"
                        },
                        {
                            "columnId": "Name",
                            "label": "Name"
                        },
                        {
                            "columnId": "Item"
                        },
                        {
                            "columnId": "ResourceGroup"
                        },
                        {
                            "columnId": "ProtectionState",
                            "label": "ProtectionState"
                        },
                        {
                            "columnId": "ResourceState",
                            "label": "ResourceState"
                        },
                        {
                            "columnId": "InDeferredDelete",
                            "label": "InDeferredDelete"
                        },
                        {
                            "columnId": "HealthCheck",
                            "label": "HealthCheck"
                        },
                        {
                            "columnId": "LastBackup",
                            "label": "LastBackup"
                        },
                        {
                            "columnId": "LastBackupTime",
                            "label": "LastBackupTime"
                        },
                        {
                            "columnId": "LastRecoveryPoint",
                            "label": "LastRecoveryPoint"
                        },
                        {
                            "columnId": "Host",
                            "label": "Host"
                        },
                        {
                            "columnId": "DailyRetention",
                            "label": "DailyRetention"
                        },
                        {
                            "columnId": "InstantRpRetention",
                            "label": "SnapshotRetention"
                        },
                        {
                            "columnId": "PolicyName",
                            "label": "Policy"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "Info",
                            "label": "Info"
                        },
                        {
                            "columnId": "InfoDetails",
                            "label": "InfoDetails"
                        },
                        {
                            "columnId": "row_num"
                        },
                        {
                            "columnId": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Items"
                },
                {
                    "parameterName": "BackupItemView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Items"
            },
            "showPin": true,
            "name": "query - 11",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemName",
                        "label": "Search Item or RG",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-118\">用于通过资源组和/或名称进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-118\">Use to filter using resource group and/or name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "db5ab575-14f6-44d0-bbb9-71c59d0d86b2",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyName",
                        "label": "Search Vault",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-119\">使用按保管库和/或策略名进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-119\">Use to filter by vault and/or policy name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "ProtectionState",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Protected\", \"label\":\"Protected\" },\r\n    { \"value\":\"ProtectionStopped\", \"label\":\"ProtectionStopped\" },\r\n    { \"value\":\"IRPending\", \"label\":\"IRPending\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ad30973f-5071-4ce4-9f2b-df9a93955879",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResourceState",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"VM Active\", \"label\":\"VM Active\" },\r\n    { \"value\":\"VM Not Found\", \"label\":\"VM Not Found\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2a76174a-d5a5-41bb-99d2-9d2fce0e3167",
                        "version": "KqlParameterItem/1.0",
                        "name": "HealthCheck",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Passed\", \"label\":\"Passed\" },\r\n    { \"value\":\"ActionRequired\", \"label\":\"ActionRequired\" },\r\n    { \"value\":\"ActionSuggested\", \"label\":\"ActionSuggested\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend ResourceState = iff(tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2])))) in ({VMHash}), \"VM Active\", \"VM Not Found\")\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.containerName))),\r\n          ProtectionState = tostring(properties.protectionState),\r\n          ResourceState,\r\n\t\t  InDeferredDelete = iff(tostring(properties.isScheduledForDeferredDelete) == \"true\", \"Yes\", \"No\"),\r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id)\r\n| where Name contains (@\"{BackupItemName}\") \r\n| where VaultName contains (@\"{PolicyName}\")\r\n| where ProtectionState == \"{ProtectionState}\" or strcat(ProtectionState,\"{ProtectionState}\") contains \"All\"\r\n| where ResourceState == \"{ResourceState}\" or strcat(ResourceState,\"{ResourceState}\") contains \"All\"\r\n| where HealthCheck == \"{HealthCheck}\" or strcat(HealthCheck,\"{HealthCheck}\") contains \"All\"\r\n| project backupItemId,\r\n\t\t  Name,\r\n          ProtectionState,\r\n          ResourceState,\r\n\t\t  InDeferredDelete,\r\n\t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = format_datetime(todatetime(LastBackupTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n          LastRecoveryPoint = format_datetime(todatetime(LastRecoveryPoint),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  backupItemHostId,\r\n\t\t  Host,\r\n\t\t  VaultName,\r\n\t\t  vaultId\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Items"
                },
                {
                    "parameterName": "BackupItemView",
                    "comparison": "isEqualTo",
                    "value": "Standard"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Items"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend ResourceState = iff(tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2])))) in ({VMHash}), \"VM Active\", \"VM Not Found\")\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.containerName))),\r\n          ProtectionState = tostring(properties.protectionState),\r\n          ResourceState,\r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id)\r\n| where Name contains (@\"{BackupItemName}\") \r\n| where VaultName contains (@\"{PolicyName}\")\r\n| where ProtectionState == \"{ProtectionState}\" or strcat(ProtectionState,\"{ProtectionState}\") contains \"All\"\r\n| where ResourceState == \"{ResourceState}\" or strcat(ResourceState,\"{ResourceState}\") contains \"All\"\r\n| where HealthCheck == \"{HealthCheck}\" or strcat(HealthCheck,\"{HealthCheck}\") contains \"All\"\r\n| project backupItemId,\r\n\t\t  Name,\r\n          Item = tostring(split(Name,\";\")[1]),\r\n          ResourceGroup = tostring(split(Name,\";\")[0]),\r\n          ProtectionState,\r\n          ResourceState,\r\n\t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = format_datetime(todatetime(LastBackupTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n          LastRecoveryPoint = format_datetime(todatetime(LastRecoveryPoint),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  Host = iff(ResourceState == \"VM Active\",backupItemHostId,\"\"),\r\n\t\t  vaultId\r\n| sort by backupItemId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{BackupItemPageNumber}') or '*' in ('{BackupItemPageNumber}')\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "backupItemId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Name",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Item",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "backupItemId",
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceGroup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ProtectionState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "HealthCheck",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackupTime",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastRecoveryPoint",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Host",
                            "formatter": 13,
                            "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "PolicyName",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "backupItemHostId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "backupItemId",
                            "label": "backupItemId"
                        },
                        {
                            "columnId": "Name",
                            "label": "Name"
                        },
                        {
                            "columnId": "Item",
                            "label": "Item"
                        },
                        {
                            "columnId": "ResourceGroup",
                            "label": "ResourceGroup"
                        },
                        {
                            "columnId": "ProtectionState",
                            "label": "ProtectionState"
                        },
                        {
                            "columnId": "ResourceState",
                            "label": "ResourceState"
                        },
                        {
                            "columnId": "HealthCheck",
                            "label": "HealthCheck"
                        },
                        {
                            "columnId": "LastBackup",
                            "label": "LastBackup"
                        },
                        {
                            "columnId": "LastBackupTime",
                            "label": "LastBackupTime"
                        },
                        {
                            "columnId": "LastRecoveryPoint",
                            "label": "LastRecoveryPoint"
                        },
                        {
                            "columnId": "Host",
                            "label": "Host"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "row_num"
                        },
                        {
                            "columnId": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Items"
                },
                {
                    "parameterName": "BackupItemView",
                    "comparison": "isEqualTo",
                    "value": "Standard"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Items"
            },
            "showPin": true,
            "name": "query - 11 - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemName",
                        "label": "Search Name",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-120\">用于通过资源组和/或名称进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-120\">Use to filter using resource group and/or name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "Operation",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Backup\", \"label\":\"Backup\" },\r\n    { \"value\":\"Restore\", \"label\":\"Restore\" },\r\n    { \"value\":\"ConfigureBackup\", \"label\":\"ConfigureBackup\" },\r\n    { \"value\":\"DeleteBackupData\", \"label\":\"DeleteBackupData\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ad30973f-5071-4ce4-9f2b-df9a93955879",
                        "version": "KqlParameterItem/1.0",
                        "name": "Status",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Completed\", \"label\":\"Completed\" },\r\n    { \"value\":\"CompletedWithWarnings\", \"label\":\"CompletedWithWarnings\" },\r\n    { \"value\":\"Failed\", \"label\":\"Failed\" },\r\n    { \"value\":\"Cancelled\", \"label\":\"Cancelled\" },\r\n    { \"value\":\"InProgress\", \"label\":\"InProgress\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2a76174a-d5a5-41bb-99d2-9d2fce0e3167",
                        "version": "KqlParameterItem/1.0",
                        "name": "Error",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| where properties.entityFriendlyName contains (@\"{BackupItemName}\") \r\n| where tostring(properties.operation) == \"{Operation}\" or strcat(tostring(properties.operation),\"{Operation}\") contains \"All\"\r\n| where tostring(properties.status) == \"{Status}\" or strcat(tostring(properties.status),\"{Status}\") contains \"All\"\r\n| summarize by x = tostring(properties.errorDetails[0].errorTitle)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": [
                            "value::all"
                        ],
                        "typeSettings": {
                            "additionalResourceOptions": [
                                "value::all"
                            ],
                            "selectAllValue": "All",
                            "showDefault": false
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "JobPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| where properties.entityFriendlyName contains (@\"{BackupItemName}\") \r\n| where tostring(properties.operation) == \"{Operation}\" or strcat(tostring(properties.operation),\"{Operation}\") contains \"All\"\r\n| where tostring(properties.status) == \"{Status}\" or strcat(tostring(properties.status),\"{Status}\") contains \"All\"\r\n| where tostring(properties.errorDetails[0].errorTitle) in ({Error}) or \"All\" in ({Error})\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Jobs"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| where properties.entityFriendlyName contains (@\"{BackupItemName}\") \r\n| where tostring(properties.operation) == \"{Operation}\" or strcat(tostring(properties.operation),\"{Operation}\") contains \"All\"\r\n| where tostring(properties.status) == \"{Status}\" or strcat(tostring(properties.status),\"{Status}\") contains \"All\"\r\n| where tostring(properties.errorDetails[0].errorTitle) in ({Error}) or \"All\" in ({Error})\r\n| project Name = properties.entityFriendlyName,\r\n          jobId = id,\r\n          Host = \"VM\",\r\n          Operation = properties.operation,\r\n\t      Status = properties.status,\r\n\t      StartTime = format_datetime(todatetime(properties.startTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t      Duration = format_timespan(todatetime(properties.endTime) - todatetime(properties.startTime),\"hh:mm:ss\"),\r\n\t\t  Error = properties.errorDetails[0].errorTitle,\r\n\t\t  errorDetails = pack(\"Error\",properties.errorDetails[0].errorTitle,\"ErrorString\",properties.errorDetails[0].errorString,\"Recommendations\",properties.errorDetails[0].recommendations),\r\n          vaultId\r\n| sort by jobId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{JobPageNumber}') or '*' in ('{JobPageNumber}')\r\n\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "Name",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "jobId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Host",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Operation",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Status",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "StartTime",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Duration",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Error",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "errorDetails",
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": true,
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "errorDetails",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "Name",
                            "label": "Name"
                        },
                        {
                            "columnId": "jobId",
                            "label": "jobId"
                        },
                        {
                            "columnId": "Host",
                            "label": "Host"
                        },
                        {
                            "columnId": "Operation",
                            "label": "Operation"
                        },
                        {
                            "columnId": "Status",
                            "label": "Status"
                        },
                        {
                            "columnId": "StartTime",
                            "label": "StartTime"
                        },
                        {
                            "columnId": "Duration",
                            "label": "Duration"
                        },
                        {
                            "columnId": "Error",
                            "label": "Error"
                        },
                        {
                            "columnId": "errorDetails",
                            "label": "errorDetails"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "row_num",
                            "label": "row_num"
                        },
                        {
                            "columnId": "page_num",
                            "label": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Jobs"
            },
            "showPin": true,
            "name": "query - 11 - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "BackupItemName",
                        "label": "Search Name",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-121\">用于通过资源组和/或名称进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-121\">Use to filter using resource group and/or name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "AlertName",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Backup failure\", \"label\":\"Backup failure\" },\r\n    { \"value\":\"Restore failure\", \"label\":\"Restore failure\" },\r\n    { \"value\":\"Delete Backup Data\", \"label\":\"Delete Backup Data\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ad30973f-5071-4ce4-9f2b-df9a93955879",
                        "version": "KqlParameterItem/1.0",
                        "name": "Status",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"1\", \"label\":\"Active\" },\r\n    { \"value\":\"2\", \"label\":\"Resolved\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2a76174a-d5a5-41bb-99d2-9d2fce0e3167",
                        "version": "KqlParameterItem/1.0",
                        "name": "Severity",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"1\", \"label\":\"Critical\" },\r\n    { \"value\":\"2\", \"label\":\"Warning\" },\r\n    { \"value\":\"3\", \"label\":\"Info\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "AlertPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| where replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.firstLevelContainerId))) contains (@\"{BackupItemName}\") \r\n| where tostring(properties.alertTitle) == \"{AlertName}\" or strcat(tostring(properties.alertTitle),\"{AlertName}\") contains \"All\"\r\n| where tostring(properties.status) == \"{Status}\" or strcat(tostring(properties.status),\"{Status}\") contains \"All\"\r\n| where tostring(properties.severity) == \"{Severity}\" or strcat(tostring(properties.severity),\"{Severity}\") contains \"All\"\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Alerts"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| where replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.firstLevelContainerId))) contains (@\"{BackupItemName}\") \r\n| where tostring(properties.alertTitle) == \"{AlertName}\" or strcat(tostring(properties.alertTitle),\"{AlertName}\") contains \"All\"\r\n| where tostring(properties.status) == \"{Status}\" or strcat(tostring(properties.status),\"{Status}\") contains \"All\"\r\n| where tostring(properties.severity) == \"{Severity}\" or strcat(tostring(properties.severity),\"{Severity}\") contains \"All\"\r\n| project backupItemId = strcat(vaultId,\"/backupFabrics/Azure/protectionContainers/IaasVMContainer;\",tostring(properties.firstLevelContainerId),\"/protectedItems/VM;\",tostring(properties.firstLevelContainerId)),\r\n          Item = tostring(split(tostring(properties.firstLevelContainerId),\";\")[2]),\r\n          ResourceGroup = tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]),\r\n\t\t  HostHash = hash(tolower(strcat(subscriptionId, tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]), tostring(split(tostring(properties.firstLevelContainerId),\";\")[2])))),\r\n          alertId = id, \r\n\t\t  backupItemHostId = strcat(\r\n\t\t  replace(\"\\\\/resourceGroups.*\",\"\",id),\"/resourceGroups/\",tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]),\r\n\t\t  \"/providers/Microsoft.\",\r\n\t\t  iff(tostring(properties.firstLevelContainerId) contains \"iaasvmcontainerv2;\", \"Compute/virtualMachines/\", \"ClassicCompute/virtualMachines/\"),             tostring(split(tostring(properties.firstLevelContainerId),\";\")[2])\r\n\t\t  ),\r\n\t\t  AlertName = tostring(properties.alertTitle),\r\n          CreationTime = format_datetime(todatetime(properties.initialOccurrenceTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  Duration = replace(\"\\\\..*\",\"\",tostring(properties.duration)),\r\n\t\t  Severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\")),\r\n\t\t  Status = iff(tolong(properties.status) == 1, \"Active\", \"Resolved\"),\r\n\t\t  ResolutionTime = format_datetime(todatetime(properties.resolutionTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  vaultId\r\n| project backupItemId, Item, ResourceGroup, alertId, AlertName, CreationTime, Duration, Severity, Status, \r\n          Host = iff(HostHash in ({VMHash}), backupItemHostId, \"\"), vaultId\r\n| sort by alertId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{AlertPageNumber}') or '*' in ('{AlertPageNumber}')\r\n\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "backupItemId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Item",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "backupItemId",
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceGroup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "alertId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "AlertName",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "CreationTime",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Duration",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Severity",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Status",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Host",
                            "formatter": 13,
                            "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Name",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "backupItemId",
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "backupItemHostId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResolutionTime",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "backupItemId",
                            "label": "backupItemId"
                        },
                        {
                            "columnId": "Item",
                            "label": "Item"
                        },
                        {
                            "columnId": "ResourceGroup",
                            "label": "ResourceGroup"
                        },
                        {
                            "columnId": "alertId",
                            "label": "alertId"
                        },
                        {
                            "columnId": "AlertName",
                            "label": "AlertName"
                        },
                        {
                            "columnId": "CreationTime",
                            "label": "CreationTime"
                        },
                        {
                            "columnId": "Duration",
                            "label": "Duration"
                        },
                        {
                            "columnId": "Severity",
                            "label": "Severity"
                        },
                        {
                            "columnId": "Status",
                            "label": "Status"
                        },
                        {
                            "columnId": "Host",
                            "label": "Host"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "row_num",
                            "label": "row_num"
                        },
                        {
                            "columnId": "page_num",
                            "label": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Alerts"
            },
            "showPin": true,
            "name": "query - 11 - Copy - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "VMName",
                        "label": "Search Name or RG",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-122\">用于通过资源组或名称进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-122\">Use to filter using resource group or name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "6bfd6bdc-12c5-4e9d-9ed3-58fc3c790334",
                        "version": "KqlParameterItem/1.0",
                        "name": "Tags",
                        "label": "Search Tags",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-123\">用于通过标记进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-123\">Use to filter using tags</span></span>",
                        "value": "",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "VMPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "Resources\r\n| where type in (\"microsoft.compute/virtualmachines\", \"microsoft.classiccompute/virtualmachines\")\r\n| where tostring(hash(strcat(tolower(subscriptionId), tolower(resourceGroup), tolower(name)))) !in ({BackupItemHostHash})\r\n| where strcat(name,resourceGroup) contains (@\"{VMName}\") \r\n| where tostring(tags) contains ('{Tags}') \r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Not Protected"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy - Copy - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "Resources\r\n| where type in (\"microsoft.compute/virtualmachines\", \"microsoft.classiccompute/virtualmachines\")\r\n| where tostring(hash(strcat(tolower(subscriptionId), tolower(resourceGroup), tolower(name)))) !in ({BackupItemHostHash})\r\n| where strcat(name,resourceGroup) contains (@\"{VMName}\") \r\n| where tostring(tags) contains ('{Tags}') \r\n| project id,\r\n          Name = name,\r\n\t\t  Type = replace(\"\\\\/virtualmachines\",\"\",replace(\"microsoft.\",\"\",type)),\r\n          ResourceGroup = resourceGroup,\r\n\t\t  Location = location,\r\n\t\t  Tags = iff(isempty(tags),tags,\"Tags\"),\r\n          TagDetails = tags,\r\n          VmSize = iff(type == \"microsoft.classiccompute/virtualmachines\",properties.hardwareProfile.size, properties.hardwareProfile.vmSize),\r\n\t\t  OsType = iff(type == \"microsoft.classiccompute/virtualmachines\", properties.storageProfile.operatingSystemDisk.operatingSystem, properties.storageProfile.osDisk.osType)\r\n| sort by id asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{VMPageNumber}') or '*' in ('{VMPageNumber}')\r\n\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "id",
                            "formatter": 13,
                            "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Name",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": false
                            }
                        },
                        {
                            "columnMatch": "Type",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceGroup",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Location",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Tags",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "TagDetails",
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": true,
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "TagDetails",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "VmSize",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "OsType",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "id",
                            "label": "Name"
                        },
                        {
                            "columnId": "Name",
                            "label": "VMName"
                        },
                        {
                            "columnId": "Type",
                            "label": "Type"
                        },
                        {
                            "columnId": "ResourceGroup",
                            "label": "ResourceGroup"
                        },
                        {
                            "columnId": "Location",
                            "label": "Location"
                        },
                        {
                            "columnId": "Tags",
                            "label": "Tags"
                        },
                        {
                            "columnId": "TagDetails",
                            "label": "TagDetails"
                        },
                        {
                            "columnId": "VmSize",
                            "label": "VmSize"
                        },
                        {
                            "columnId": "OsType",
                            "label": "OsType"
                        },
                        {
                            "columnId": "row_num",
                            "label": "row_num"
                        },
                        {
                            "columnId": "page_num",
                            "label": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Not Protected"
            },
            "showPin": true,
            "name": "query - 11 - Copy - Copy - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "db5ab575-14f6-44d0-bbb9-71c59d0d86b2",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyName",
                        "label": "Search Vault or Policy",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-124\">使用按保管库和/或策略名进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-124\">Use to filter by vault and/or policy name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "0588c964-1b62-424b-aef3-34f05435548a",
                        "version": "KqlParameterItem/1.0",
                        "name": "HasProtectedItems",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Yes\", \"label\":\"Yes\" },\r\n    { \"value\":\"No\", \"label\":\"No\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "ScheduleFrequency",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Daily\", \"label\":\"Daily\" },\r\n    { \"value\":\"Weekly\", \"label\":\"Weekly\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "0b064ac9-d8fa-4985-83e7-8f41dca55f02",
                        "version": "KqlParameterItem/1.0",
                        "name": "RetentionSchedule",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"1 == 1\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"isnotempty(DailyRetention)\", \"label\":\"Daily\" },\r\n    { \"value\":\"isnotempty(WeeklyRetention)\", \"label\":\"Weekly\" },\r\n    { \"value\":\"isnotempty(MonthlyRetention)\", \"label\":\"Monthly\" },\r\n    { \"value\":\"isnotempty(YearlyRetention)\", \"label\":\"Yearly\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "dd894ccd-2ec7-456b-941a-f3ca616ad9e3",
                        "version": "KqlParameterItem/1.0",
                        "name": "MinRetention",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-125\">指定备份的内容在保管库中保留的最少天数/星期数/月数/年限。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-125\">Specify minimum number of days/weeks/months/years the backup is retained in the vault.</span></span> <span data-ttu-id=\"2fa04-126\">使用 RetentionTypeFilter 选择每日/每周/每月/每年保留。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-126\">Use RetentionTypeFilter to choose daily/weekly/monthly/yearly.</span></span> <span data-ttu-id=\"2fa04-127\">如果使用零，则对最小保留期不应用任何筛选器，无论 RetentionFilterType 选择了什么</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-127\">Use zero to not apply any filter on min retention irrespective of the choice of RetentionFilterType</span></span>",
                        "isRequired": true,
                        "value": "0",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "1fc96995-297e-476d-8964-83b0d0e3687c",
                        "version": "KqlParameterItem/1.0",
                        "name": "MaxRetention",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-128\">指定每日备份的内容在保管库中保留的最多天数</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-128\">Specify maximum number of days the daily backup is retained in the vault</span></span>",
                        "isRequired": true,
                        "value": "3650",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "4c20879b-cb6e-4c9c-8923-0af5a1c063bd",
                        "version": "KqlParameterItem/1.0",
                        "name": "RetentionFilterType",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-129\">用于指定要应用最小和最大保留期筛选器的保留计划</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-129\">Use to specify on which retention schedule the min and max retention filters apply</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"Daily\", \"label\":\"Daily\", \"selected\": true },\r\n    { \"value\":\"Weekly\", \"label\":\"Weekly\" },\r\n    { \"value\":\"Monthly\", \"label\":\"Monthly\" },\r\n    { \"value\":\"Yearly\", \"label\":\"Yearly\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "1d767e68-5daf-4741-afa5-1dd017d68ba2",
                        "version": "KqlParameterItem/1.0",
                        "name": "SnapshotRetention",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-130\">为实现按天数进行筛选的功能，保留了备份快照以实现快速还原。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-130\">To filter by number of days the backup snapshot is retained for fast restores.</span></span> <span data-ttu-id=\"2fa04-131\">使用零来查看未设置快照保留的行。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-131\">Use zero to view rows with no snapshot retention.</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"0\", \"label\":\"0\" },\r\n    { \"value\":\"1\", \"label\":\"1\" },\r\n    { \"value\":\"2\", \"label\":\"2\" },\r\n    { \"value\":\"3\", \"label\":\"3\" },\r\n    { \"value\":\"4\", \"label\":\"4\" },\r\n    { \"value\":\"5\", \"label\":\"5\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "ad30973f-5071-4ce4-9f2b-df9a93955879",
                        "version": "KqlParameterItem/1.0",
                        "name": "RunDays",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-132\">用于筛选一周中要在星期几运行计划的筛选器。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-132\">Filter for days of the week the schedule is run.</span></span> <span data-ttu-id=\"2fa04-133\">当计划的频率为每周时使用</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-133\">Use when schedule frequency is weekly</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupPolicies.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend PolicyId = tolower(id)\r\n| join kind = leftouter\r\n(\r\n    recoveryservicesresources\r\n    | where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n    | summarize ProtectedItems = count() by PolicyId = tolower(tostring(properties.policyId))\r\n) on PolicyId\r\n| project id,\r\n          PolicyName = replace(\".*\\\\/backupPolicies\\\\/\",\"\",id),\r\n\t\t  vaultId,\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",vaultId),\r\n\t\t  ProtectedItems,\r\n          RunTime = strcat(tostring(properties.schedulePolicy.scheduleRunTimes[0]),\" \",iff(isempty(tostring(properties.timeZone)),\"UTC\",tostring(properties.timeZone))),\r\n          Frequency = tostring(properties.schedulePolicy.scheduleRunFrequency),\r\n          RunDays = tostring(properties.schedulePolicy.scheduleRunDays),\r\n \t      SnapshotRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)),\"2\",tostring(properties.instantRpRetentionRangeInDays)),\r\n          DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n          WeeklyRetention = tostring(properties.retentionPolicy.weeklySchedule.retentionDuration.['count']),\r\n          MonthlyRetention = tostring(properties.retentionPolicy.monthlySchedule.retentionDuration.['count']),\r\n          YearlyRetention = tostring(properties.retentionPolicy.yearlySchedule.retentionDuration.['count']),\r\n\t\t  Daily = \"Daily\", Weekly = \"Weekly\", Monthly = \"Monthly\", Yearly = \"Yearly\"\r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where (isnull(ProtectedItems) and \"{HasProtectedItems}\" == \"No\") or (isnotnull(ProtectedItems) and \"{HasProtectedItems}\" == \"Yes\") or (strcat(tostring(ProtectedItems),\"{HasProtectedItems}\") contains \"All\") \r\n| where {RetentionSchedule}\r\n| where Frequency == \"{ScheduleFrequency}\" or strcat(Frequency,\"{ScheduleFrequency}\") contains \"All\"\r\n| where ((Daily == \"{RetentionFilterType}\") and ((tolong(DailyRetention) >= {MinRetention} and tolong(DailyRetention) <= {MaxRetention}) \r\n        or (isempty(DailyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Weekly == \"{RetentionFilterType}\") and ((tolong(WeeklyRetention) >= {MinRetention} and tolong(WeeklyRetention) <= {MaxRetention}) \r\n        or (isempty(WeeklyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Monthly == \"{RetentionFilterType}\") and ((tolong(MonthlyRetention) >= {MinRetention} and tolong(MonthlyRetention) <= {MaxRetention}) \r\n        or (isempty(MonthlyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Yearly == \"{RetentionFilterType}\") and ((tolong(YearlyRetention) >= {MinRetention} and tolong(YearlyRetention) <= {MaxRetention}) \r\n        or (isempty(YearlyRetention) and tolong({MinRetention}) <= 0)))\r\n| where SnapshotRetention == \"{SnapshotRetention}\" or strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(SnapshotRetention) and strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| where RunDays contains (@\"{RunDays}\")\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency = Frequency, RunDays, SnapshotRetention,\r\n          DailyRetention = iff(isnotempty(DailyRetention),strcat(DailyRetention,\" days \"),DailyRetention),\r\n\t\t  WeeklyRetention = iff(isnotempty(WeeklyRetention),strcat(WeeklyRetention,\" weeks \"),WeeklyRetention),\r\n\t\t  MonthlyRetention = iff(isnotempty(MonthlyRetention),strcat(MonthlyRetention,\" months \"),MonthlyRetention),\r\n\t\t  YearlyRetention = iff(isnotempty(YearlyRetention),strcat(YearlyRetention,\" years \"),YearlyRetention)\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency, RunDays, SnapshotRetention,\r\n          MaxRetention = iff(isempty(YearlyRetention),iff(isempty(MonthlyRetention),iff(isempty(WeeklyRetention),DailyRetention,WeeklyRetention),MonthlyRetention),YearlyRetention),\r\n\t\t  Retention = strcat(DailyRetention,WeeklyRetention,MonthlyRetention,YearlyRetention)\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "bfe11186-998c-4f54-8e1d-6a58f0c3630a",
                        "version": "KqlParameterItem/1.0",
                        "name": "SelectedPolicyId",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupPolicies.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend PolicyId = tolower(id)\r\n| join kind = leftouter\r\n(\r\n    recoveryservicesresources\r\n    | where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n    | summarize ProtectedItems = count() by PolicyId = tolower(tostring(properties.policyId))\r\n) on PolicyId\r\n| project id,\r\n          PolicyName = replace(\".*\\\\/backupPolicies\\\\/\",\"\",id),\r\n\t\t  vaultId,\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",vaultId),\r\n\t\t  ProtectedItems,\r\n          RunTime = strcat(tostring(properties.schedulePolicy.scheduleRunTimes[0]),\" \",iff(isempty(tostring(properties.timeZone)),\"UTC\",tostring(properties.timeZone))),\r\n          Frequency = tostring(properties.schedulePolicy.scheduleRunFrequency),\r\n          RunDays = tostring(properties.schedulePolicy.scheduleRunDays),\r\n \t      SnapshotRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)),\"2\",tostring(properties.instantRpRetentionRangeInDays)),\r\n          DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n          WeeklyRetention = tostring(properties.retentionPolicy.weeklySchedule.retentionDuration.['count']),\r\n          MonthlyRetention = tostring(properties.retentionPolicy.monthlySchedule.retentionDuration.['count']),\r\n          YearlyRetention = tostring(properties.retentionPolicy.yearlySchedule.retentionDuration.['count']),\r\n\t\t  Daily = \"Daily\", Weekly = \"Weekly\", Monthly = \"Monthly\", Yearly = \"Yearly\"\r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where (isnull(ProtectedItems) and \"{HasProtectedItems}\" == \"No\") or (isnotnull(ProtectedItems) and \"{HasProtectedItems}\" == \"Yes\") or (strcat(tostring(ProtectedItems),\"{HasProtectedItems}\") contains \"All\") \r\n| where Frequency == \"{ScheduleFrequency}\" or strcat(Frequency,\"{ScheduleFrequency}\") contains \"All\"\r\n| where {RetentionSchedule}\r\n| where ((Daily == \"{RetentionFilterType}\") and ((tolong(DailyRetention) >= {MinRetention} and tolong(DailyRetention) <= {MaxRetention}) \r\n        or (isempty(DailyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Weekly == \"{RetentionFilterType}\") and ((tolong(WeeklyRetention) >= {MinRetention} and tolong(WeeklyRetention) <= {MaxRetention}) \r\n        or (isempty(WeeklyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Monthly == \"{RetentionFilterType}\") and ((tolong(MonthlyRetention) >= {MinRetention} and tolong(MonthlyRetention) <= {MaxRetention}) \r\n        or (isempty(MonthlyRetention) and tolong({MinRetention}) <= 0)))\r\n\tor \r\n\t    ((Yearly == \"{RetentionFilterType}\") and ((tolong(YearlyRetention) >= {MinRetention} and tolong(YearlyRetention) <= {MaxRetention}) \r\n        or (isempty(YearlyRetention) and tolong({MinRetention}) <= 0)))\r\n| where SnapshotRetention == \"{SnapshotRetention}\" or strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(SnapshotRetention) and strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| where RunDays contains (@\"{RunDays}\")\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency = Frequency, RunDays, SnapshotRetention,\r\n          DailyRetention = iff(isnotempty(DailyRetention),strcat(DailyRetention,\" days \"),DailyRetention),\r\n\t\t  WeeklyRetention = iff(isnotempty(WeeklyRetention),strcat(WeeklyRetention,\" weeks \"),WeeklyRetention),\r\n\t\t  MonthlyRetention = iff(isnotempty(MonthlyRetention),strcat(MonthlyRetention,\" months \"),MonthlyRetention),\r\n\t\t  YearlyRetention = iff(isnotempty(YearlyRetention),strcat(YearlyRetention,\" years \"),YearlyRetention)\r\n| project id, PolicyName, vaultId, ProtectedItems, SnapshotRetention,\r\n          MaxRetention = iff(isempty(YearlyRetention),iff(isempty(MonthlyRetention),iff(isempty(WeeklyRetention),DailyRetention,WeeklyRetention),MonthlyRetention),YearlyRetention),\r\n\t\t  Retention = strcat(DailyRetention,WeeklyRetention,MonthlyRetention,YearlyRetention), RunTime, BackupFrequency, RunDays\r\n| sort by ProtectedItems desc, id asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{PolicyPageNumber}') or '*' in ('{PolicyPageNumber}')",
                "size": 3,
                "exportFieldName": "id",
                "exportParameterName": "SelectedPolicyId",
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "id",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "PolicyName",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ProtectedItems",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "RunTime",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "BackupFrequency",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "RunDays",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "SnapshotRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "MaxRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Retention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "id",
                            "label": "id"
                        },
                        {
                            "columnId": "PolicyName",
                            "label": "Policy"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "ProtectedItems",
                            "label": "ProtectedItems"
                        },
                        {
                            "columnId": "SnapshotRetention",
                            "label": "SnapshotRetention"
                        },
                        {
                            "columnId": "MaxRetention",
                            "label": "MaxRetention"
                        },
                        {
                            "columnId": "Retention",
                            "label": "Retention"
                        },
                        {
                            "columnId": "RunTime",
                            "label": "RunTime"
                        },
                        {
                            "columnId": "BackupFrequency",
                            "label": "BackupFrequency"
                        },
                        {
                            "columnId": "RunDays",
                            "label": "RunDays"
                        },
                        {
                            "columnId": "row_num"
                        },
                        {
                            "columnId": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "showPin": true,
            "name": "query - 11 - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "db5ab575-14f6-44d0-bbb9-71c59d0d86b2",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyName",
                        "label": "Search Vault or Policy",
                        "type": 1,
                        "description": "<span data-ttu-id=\"2fa04-134\">使用按保管库和/或策略名进行筛选</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-134\">Use to filter by vault and/or policy name</span></span>",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                    },
                    {
                        "id": "0588c964-1b62-424b-aef3-34f05435548a",
                        "version": "KqlParameterItem/1.0",
                        "name": "HasProtectedItems",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Yes\", \"label\":\"Yes\" },\r\n    { \"value\":\"No\", \"label\":\"No\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "ScheduleFrequency",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Daily\", \"label\":\"Daily\" },\r\n    { \"value\":\"Weekly\", \"label\":\"Weekly\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "0b064ac9-d8fa-4985-83e7-8f41dca55f02",
                        "version": "KqlParameterItem/1.0",
                        "name": "RetentionSchedule",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"1 == 1\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"isnotempty(DailyRetention)\", \"label\":\"Daily\" },\r\n    { \"value\":\"isnotempty(WeeklyRetention)\", \"label\":\"Weekly\" },\r\n    { \"value\":\"isnotempty(MonthlyRetention)\", \"label\":\"Monthly\" },\r\n    { \"value\":\"isnotempty(YearlyRetention)\", \"label\":\"Yearly\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "1d767e68-5daf-4741-afa5-1dd017d68ba2",
                        "version": "KqlParameterItem/1.0",
                        "name": "SnapshotRetention",
                        "type": 2,
                        "description": "<span data-ttu-id=\"2fa04-135\">为实现按天数进行筛选的功能，保留了备份快照以实现快速还原。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-135\">To filter by number of days the backup snapshot is retained for fast restores.</span></span> <span data-ttu-id=\"2fa04-136\">使用零来查看未设置快照保留的行。</span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-136\">Use zero to view rows with no snapshot retention.</span></span>",
                        "isRequired": true,
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"0\", \"label\":\"0\" },\r\n    { \"value\":\"1\", \"label\":\"1\" },\r\n    { \"value\":\"2\", \"label\":\"2\" },\r\n    { \"value\":\"3\", \"label\":\"3\" },\r\n    { \"value\":\"4\", \"label\":\"4\" },\r\n    { \"value\":\"5\", \"label\":\"5\" }\r\n]",
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange"
                    },
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "PolicyPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupPolicies.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend PolicyId = tolower(id)\r\n| join kind = leftouter\r\n(\r\n    recoveryservicesresources\r\n    | where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n    | summarize ProtectedItems = count() by PolicyId = tolower(tostring(properties.policyId))\r\n) on PolicyId\r\n| project id,\r\n          PolicyName = replace(\".*\\\\/backupPolicies\\\\/\",\"\",id),\r\n\t\t  vaultId,\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",vaultId),\r\n\t\t  ProtectedItems,\r\n          RunTime = strcat(tostring(properties.schedulePolicy.scheduleRunTimes[0]),\" \",iff(isempty(tostring(properties.timeZone)),\"UTC\",tostring(properties.timeZone))),\r\n          Frequency = tostring(properties.schedulePolicy.scheduleRunFrequency),\r\n          RunDays = tostring(properties.schedulePolicy.scheduleRunDays),\r\n \t      SnapshotRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)),\"2\",tostring(properties.instantRpRetentionRangeInDays)),\r\n          DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n          WeeklyRetention = tostring(properties.retentionPolicy.weeklySchedule.retentionDuration.['count']),\r\n          MonthlyRetention = tostring(properties.retentionPolicy.monthlySchedule.retentionDuration.['count']),\r\n          YearlyRetention = tostring(properties.retentionPolicy.yearlySchedule.retentionDuration.['count']),\r\n\t\t  Daily = \"Daily\", Weekly = \"Weekly\", Monthly = \"Monthly\", Yearly = \"Yearly\"\r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where (isnull(ProtectedItems) and \"{HasProtectedItems}\" == \"No\") or (isnotnull(ProtectedItems) and \"{HasProtectedItems}\" == \"Yes\") or (strcat(tostring(ProtectedItems),\"{HasProtectedItems}\") contains \"All\") \r\n| where Frequency == \"{ScheduleFrequency}\" or strcat(Frequency,\"{ScheduleFrequency}\") contains \"All\"\r\n| where {RetentionSchedule}\r\n| where SnapshotRetention == \"{SnapshotRetention}\" or strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(SnapshotRetention) and strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency = Frequency, RunDays, SnapshotRetention,\r\n          DailyRetention = iff(isnotempty(DailyRetention),strcat(DailyRetention,\" days \"),DailyRetention),\r\n\t\t  WeeklyRetention = iff(isnotempty(WeeklyRetention),strcat(WeeklyRetention,\" weeks \"),WeeklyRetention),\r\n\t\t  MonthlyRetention = iff(isnotempty(MonthlyRetention),strcat(MonthlyRetention,\" months \"),MonthlyRetention),\r\n\t\t  YearlyRetention = iff(isnotempty(YearlyRetention),strcat(YearlyRetention,\" years \"),YearlyRetention)\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency, RunDays, SnapshotRetention,\r\n          MaxRetention = iff(isempty(YearlyRetention),iff(isempty(MonthlyRetention),iff(isempty(WeeklyRetention),DailyRetention,WeeklyRetention),MonthlyRetention),YearlyRetention),\r\n\t\t  Retention = strcat(DailyRetention,WeeklyRetention,MonthlyRetention,YearlyRetention)\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Standard"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "customWidth": "100",
            "name": "parameters - 7 - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%"
            }
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupPolicies.*\",\"\",id))\r\n| where vaultId in ({Vault}) or (\"*\" in ({Vault}) and tostring(hash(vaultId)) in ({AllVaultHash}))\r\n| extend PolicyId = tolower(id)\r\n| join kind = leftouter\r\n(\r\n    recoveryservicesresources\r\n    | where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n    | summarize ProtectedItems = count() by PolicyId = tolower(tostring(properties.policyId))\r\n) on PolicyId\r\n| project id,\r\n          PolicyName = replace(\".*\\\\/backupPolicies\\\\/\",\"\",id),\r\n\t\t  vaultId,\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",vaultId),\r\n\t\t  ProtectedItems,\r\n          RunTime = strcat(tostring(properties.schedulePolicy.scheduleRunTimes[0]),\" \",iff(isempty(tostring(properties.timeZone)),\"UTC\",tostring(properties.timeZone))),\r\n          Frequency = tostring(properties.schedulePolicy.scheduleRunFrequency),\r\n          RunDays = tostring(properties.schedulePolicy.scheduleRunDays),\r\n \t      SnapshotRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)),\"2\",tostring(properties.instantRpRetentionRangeInDays)),\r\n          DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n          WeeklyRetention = tostring(properties.retentionPolicy.weeklySchedule.retentionDuration.['count']),\r\n          MonthlyRetention = tostring(properties.retentionPolicy.monthlySchedule.retentionDuration.['count']),\r\n          YearlyRetention = tostring(properties.retentionPolicy.yearlySchedule.retentionDuration.['count']),\r\n\t\t  Daily = \"Daily\", Weekly = \"Weekly\", Monthly = \"Monthly\", Yearly = \"Yearly\"\r\n| where PolicyName contains (@\"{PolicyName}\") or VaultName contains (@\"{PolicyName}\")\r\n| where (isnull(ProtectedItems) and \"{HasProtectedItems}\" == \"No\") or (isnotnull(ProtectedItems) and \"{HasProtectedItems}\" == \"Yes\") or (strcat(tostring(ProtectedItems),\"{HasProtectedItems}\") contains \"All\") \r\n| where Frequency == \"{ScheduleFrequency}\" or strcat(Frequency,\"{ScheduleFrequency}\") contains \"All\"\r\n| where {RetentionSchedule}\r\n| where SnapshotRetention == \"{SnapshotRetention}\" or strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(SnapshotRetention) and strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency = Frequency, RunDays, SnapshotRetention,\r\n          DailyRetention = iff(isnotempty(DailyRetention),strcat(DailyRetention,\" days \"),DailyRetention),\r\n\t\t  WeeklyRetention = iff(isnotempty(WeeklyRetention),strcat(WeeklyRetention,\" weeks \"),WeeklyRetention),\r\n\t\t  MonthlyRetention = iff(isnotempty(MonthlyRetention),strcat(MonthlyRetention,\" months \"),MonthlyRetention),\r\n\t\t  YearlyRetention = iff(isnotempty(YearlyRetention),strcat(YearlyRetention,\" years \"),YearlyRetention)\r\n| project id, PolicyName, vaultId, ProtectedItems, SnapshotRetention,\r\n          MaxRetention = iff(isempty(YearlyRetention),iff(isempty(MonthlyRetention),iff(isempty(WeeklyRetention),DailyRetention,WeeklyRetention),MonthlyRetention),YearlyRetention),\r\n\t\t  Retention = strcat(DailyRetention,WeeklyRetention,MonthlyRetention,YearlyRetention), BackupFrequency\r\n| sort by ProtectedItems desc, id asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{PolicyPageNumber}') or '*' in ('{PolicyPageNumber}')",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "id",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "PolicyName",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ProtectedItems",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "RunTime",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "BackupFrequency",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "RunDays",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "SnapshotRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "MaxRetention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Retention",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "id",
                            "label": "id"
                        },
                        {
                            "columnId": "PolicyName",
                            "label": "Policy"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "ProtectedItems",
                            "label": "ProtectedItems"
                        },
                        {
                            "columnId": "SnapshotRetention",
                            "label": "SnapshotRetention"
                        },
                        {
                            "columnId": "MaxRetention",
                            "label": "MaxRetention"
                        },
                        {
                            "columnId": "Retention",
                            "label": "Retention"
                        },
                        {
                            "columnId": "BackupFrequency",
                            "label": "BackupFrequency"
                        },
                        {
                            "columnId": "row_num"
                        },
                        {
                            "columnId": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Standard"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "showPin": true,
            "name": "query - 11 - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        },
        {
            "type": 1,
            "content": {
                "json": "<div><span style=\"font-size:18px;\">&nbsp;<br/><span data-ttu-id=\"2fa04-137\"></span><span style=\"font-size:14px;\">以上所选策略管理的备份项</span></span><span class=\"sxs-lookup\"><span data-stu-id=\"2fa04-137\"></span><span style=\"font-size:14px;\">Backup Items managed by above selected policy</span></span></span></div>"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "SelectedPolicyId",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "customWidth": "0",
            "name": "text - 35"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "parameters": [
                    {
                        "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                        "version": "KqlParameterItem/1.0",
                        "name": "SelectedPolicyBackupItemPageNumber",
                        "label": "Page:",
                        "type": 2,
                        "isRequired": true,
                        "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where tolower(properties.policyId) == tolower(\"{SelectedPolicyId}\")\r\n| summarize c=count()\r\n| project num = (c-1)/{RowsPerPage} + 1\r\n| project nums = range(1,num,1)\r\n| mvexpand nums\r\n| project nums = tostring(nums)",
                        "crossComponentResources": [
                            "{Subscriptions}"
                        ],
                        "value": "1",
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    }
                ],
                "style": "above",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "SelectedPolicyId",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "customWidth": "0",
            "name": "parameters - 7 - Copy - Copy - Copy"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where tolower(properties.policyId) == tolower(\"{SelectedPolicyId}\")\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| extend ResourceState = iff(tostring(hash(strcat(tolower(subscriptionId), tolower(split(tostring(properties.containerName),\";\")[1]), tolower(split(tostring(properties.containerName),\";\")[2])))) in ({VMHash}), \"VM Active\", \"VM Not Found\")\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tostring(properties.containerName))),\r\n          ProtectionState = tostring(properties.protectionState),\r\n          ResourceState,\r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id)\r\n| project backupItemId,\r\n\t\t  Name,\r\n          Item = tostring(split(Name,\";\")[1]),\r\n          ResourceGroup = tostring(split(Name,\";\")[0]),\r\n          ProtectionState,\r\n          ResourceState,\r\n\t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = format_datetime(todatetime(LastBackupTime),\"yyyy-MM-dd HH:mm:ss\"),\r\n          LastRecoveryPoint = format_datetime(todatetime(LastRecoveryPoint),\"yyyy-MM-dd HH:mm:ss\"),\r\n\t\t  Host = iff(ResourceState == \"VM Active\",backupItemHostId,\"\"),\r\n\t\t  vaultId\r\n| sort by backupItemId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{RowsPerPage} + 1))\r\n| where page_num has ('{SelectedPolicyBackupItemPageNumber}') or '*' in ('{SelectedPolicyBackupItemPageNumber}')\r\n",
                "size": 3,
                "exportDefaultValue": "*",
                "showExportToExcel": true,
                "exportToExcelOptions": "visible",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "crossComponentResources": [
                    "{Subscriptions}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "backupItemId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Name",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Item",
                            "formatter": 1,
                            "formatOptions": {
                                "linkColumn": "backupItemId",
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceGroup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ProtectionState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "ResourceState",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "HealthCheck",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackup",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastBackupTime",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "LastRecoveryPoint",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Host",
                            "formatter": 13,
                            "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "PolicyName",
                            "formatter": 1,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "vaultId",
                            "formatter": 0,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "row_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "page_num",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "backupItemHostId",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        }
                    ],
                    "rowLimit": 1000,
                    "labelSettings": [
                        {
                            "columnId": "backupItemId",
                            "label": "backupItemId"
                        },
                        {
                            "columnId": "Name",
                            "label": "Name"
                        },
                        {
                            "columnId": "Item",
                            "label": "Item"
                        },
                        {
                            "columnId": "ResourceGroup",
                            "label": "ResourceGroup"
                        },
                        {
                            "columnId": "ProtectionState",
                            "label": "ProtectionState"
                        },
                        {
                            "columnId": "ResourceState",
                            "label": "ResourceState"
                        },
                        {
                            "columnId": "HealthCheck",
                            "label": "HealthCheck"
                        },
                        {
                            "columnId": "LastBackup",
                            "label": "LastBackup"
                        },
                        {
                            "columnId": "LastBackupTime",
                            "label": "LastBackupTime"
                        },
                        {
                            "columnId": "LastRecoveryPoint",
                            "label": "LastRecoveryPoint"
                        },
                        {
                            "columnId": "Host",
                            "label": "Host"
                        },
                        {
                            "columnId": "vaultId",
                            "label": "vaultId"
                        },
                        {
                            "columnId": "row_num"
                        },
                        {
                            "columnId": "page_num"
                        }
                    ]
                }
            },
            "conditionalVisibilities": [
                {
                    "parameterName": "Tabname",
                    "comparison": "isEqualTo",
                    "value": "Backup Policies"
                },
                {
                    "parameterName": "SelectedPolicyId",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                },
                {
                    "parameterName": "PolicyView",
                    "comparison": "isEqualTo",
                    "value": "Enhanced"
                }
            ],
            "conditionalVisibility": {
                "parameterName": "Tabname",
                "comparison": "isEqualTo",
                "value": "Backup Policies"
            },
            "showPin": true,
            "name": "query - 11 - Copy - Copy",
            "styleSettings": {
                "margin": "-10px 0% 0% 0%",
                "showBorder": true
            }
        }
    ],
    "styleSettings": {
        "paddingStyle": "narrow",
        "spacingStyle": "narrow"
    },
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}