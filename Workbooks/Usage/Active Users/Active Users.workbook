{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 1,
            "content": {
                "json": "## <a name=\"active-users\"></a><span data-ttu-id=\"a16ec-101\">æ´»åŠ¨ç”¨æˆ·</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-101\">Active Users</span></span>\n\n<span data-ttu-id=\"a16ec-102\">æ´»åŠ¨ç”¨æˆ·ä¼šè®¡ç®—åœ¨ä¹‹å‰çš„æ—¶é—´æ®µå†…ç”¨æˆ·è‡³å°‘æœ‰ä¸€æ¬¡ä½¿ç”¨è¿‡åº”ç”¨çš„æ¬¡æ•°ã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-102\">Active users counts how many users have used your app at least once in a previous time period.</span></span> <span data-ttu-id=\"a16ec-103\">å®ƒé€šå¸¸ç”¨äºå›ç­”â€œåº”ç”¨æˆ–åŠŸèƒ½æœ‰å¤šå°‘ç”¨æˆ·ï¼Ÿâ€çš„é—®é¢˜ã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-103\">It is typically used to answer -- *How many users does your app or feature have?*.</span></span> <span data-ttu-id=\"a16ec-104\">ç¼–è¾‘ä¸‹é¢çš„ `Activities` å‚æ•°ä»¥è‡ªå®šä¹‰å“ªäº›è‡ªå®šä¹‰äº‹ä»¶å’Œé¡µé¢è§†å›¾ç¬¦åˆæ´»åŠ¨ä½¿ç”¨æƒ…å†µã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-104\">Edit the `Activities` parameter below to customize what custom events and page views qualify as active usage.</span></span> \n"
            },
            "conditionalVisibility": null
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "593d7ebe-107d-4823-87dd-d020d2138611",
                        "version": "KqlParameterItem/1.0",
                        "name": "Metric",
                        "type": 2,
                        "isRequired": true,
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "jsonData": "[\n    { \"value\":\"1d\", \"label\":\"Daily Active Users\", \"selected\":false },\n    { \"value\":\"7d\", \"label\":\"Weekly Active Users\", \"selected\":false },\n    { \"value\":\"28d\", \"label\":\"Monthly Active Users (28d)\", \"selected\":true },\n    { \"value\":\"30d\", \"label\":\"Monthly Active Users (30d)\", \"selected\":false }\n]",
                        "timeContextFromParameter": null
                    },
                    {
                        "id": "25a6fdc1-ae28-4886-9a5c-90254deb6a3d",
                        "version": "KqlParameterItem/1.0",
                        "name": "Activities",
                        "type": 2,
                        "description": "<span data-ttu-id=\"a16ec-105\">ä»¥é€—å·åˆ†éš”çš„ä¸€ç»„é¡µé¢è§†å›¾æˆ–è¦è®¡ä¸ºæ´»åŠ¨çš„äº‹ä»¶ã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-105\">A comma separated set of Page views or Events that are to be counted as activities.</span></span> <span data-ttu-id=\"a16ec-106\">æˆ–ä½¿ç”¨â€œ\\*â€ä»¥åŒ…æ‹¬æ‰€æœ‰äº‹ä»¶ã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-106\">Or user '\\*' to include all events.</span></span>",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union customEvents, pageViews\n| where timestamp >= ago(7d)\n| summarize count() by name\n| order by count_ desc\n| project Id=name, Title=name, Selected=false\n| union (\ndatatable(Id:string, Title:string, Selected:boolean)[\n'*', 'All Events and Page Views', true,\n'%', 'All Page Views', false,\n'#', 'All Custom Events', false\n]\n)",
                        "isHiddenWhenLocked": false
                    },
                    {
                        "id": "79126a9c-4ec6-4719-872a-f4a9b022e8f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "OtherFilters",
                        "type": 1,
                        "description": "<span data-ttu-id=\"a16ec-107\">è¿›ä¸€æ­¥ç­›é€‰æ´»åŠ¨çš„ KQL ä»£ç ç‰‡æ®µã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-107\">A KQL snippet that further filters the activities.</span></span> <span data-ttu-id=\"a16ec-108\">ç¤ºä¾‹ï¼š| where application_Version == '1.0'</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-108\">Example: | where application_Version == '1.0'</span></span>",
                        "isRequired": false
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let start = startofday(ago({Metric}));\nunion customEvents, pageViews\n| where timestamp >= start\n| where name in ({Activities}) or '*' in ({Activities}) or ('%' in ({Activities}) and itemType == 'pageView') or ('#' in ({Activities}) and itemType == 'customEvent')\n{OtherFilters}\n| summarize Users = dcount(user_Id), Sessions = dcount(session_Id), Views = count()\n| evaluate narrow()\n| project Title = case(Column == 'Users', 'Active Users', Column == 'Sessions', 'Unique Sessions', 'Views'), Metric = Value, SubTitle = 'â”â”'",
                "showQuery": false,
                "size": 3,
                "aggregation": 0,
                "showAnnotations": false,
                "showAnalytics": false,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "Title",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "subtitleContent": {
                        "columnMatch": "SubTitle",
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "Metric",
                        "formatter": 12,
                        "formatOptions": {
                            "min": 0,
                            "showIcon": true
                        },
                        "numberFormat": {
                            "unit": 17,
                            "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                            }
                        }
                    },
                    "showBorder": false
                }
            },
            "conditionalVisibility": null
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "25e8351b-5036-4438-86dc-10eb4151e014",
                        "version": "KqlParameterItem/1.0",
                        "name": "SplitBy",
                        "type": 2,
                        "isRequired": true,
                        "query": "datatable(value:string, text:string)[\n'name', 'ğŸ“› Activity Name',\n'cloud_RoleInstance', 'ğŸ–¥ï¸ Machine',\n'client_CountryOrRegion', 'ğŸ“ Country or Region',\n'client_StateOrProvince', 'ğŸ“ State or Province',\n'client_City', 'ğŸ“ City',\n'client_Browser', 'ğŸŒ Client Browser',\n'client_OS', 'ğŸ–¥ï¸ Client Operating System',\n'client_Model', 'ğŸ“± Client Model',\n'application_Version', 'âšª Application Version',\n'operation_Name', 'âšª Operation',\n]\n| extend selected = false, group = 'Standard'\n| union (union pageViews, customEvents\n| where timestamp >= ago(1d)\n| where name in ({Activities}) or '*' in ({Activities})\n| project customDimensions \n| summarize schema = buildschema(customDimensions) \n| mvexpand schema\n| extend e = extract(@'{\"(.+)\":.+}', 1, tostring(schema))\n| project text = strcat('â„ï¸ ', e), value = strcat('customDimensions[\"', e, '\"]')\n| extend selected = false, group = 'Custom')",
                        "value": "name",
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContextFromParameter": null,
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let start = startofday(ago({Metric}));\r\nlet events = union customEvents, pageViews\r\n| where timestamp >= start\r\n| where name in ({Activities}) or '*' in ({Activities}) or ('%' in ({Activities}) and itemType == 'pageView') or ('#' in ({Activities}) and itemType == 'customEvent')\r\n{OtherFilters}\r\n| extend Dim1 = tostring({SplitBy});\r\nlet overall = events |  summarize Users = dcount(user_Id);\r\nlet allUsers = toscalar(overall);\r\nevents\r\n| summarize Users = dcount(user_Id), Sessions = dcount(session_Id), Instances = count() by Dim1\r\n| extend DisplayDim = strcat('ğŸ”¹ ', Dim1)\r\n| order by Users desc\r\n| project Dim1, DisplayDim, Users, Sessions, Instances\r\n| project ['Activities'] = DisplayDim, Values = Dim1, ['Active Users'] = Users, ['Unique Sessions'] = Sessions, ['Total Instances'] = Instances\r\n",
                "showQuery": false,
                "size": 0,
                "aggregation": 5,
                "showAnnotations": false,
                "exportFieldName": "Values",
                "exportParameterName": "Filter",
                "exportDefaultValue": "All events",
                "showAnalytics": true,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "Value",
                            "formatter": 5,
                            "formatOptions": {
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Active Users",
                            "formatter": 3,
                            "formatOptions": {
                                "min": 0,
                                "palette": "blue",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        },
                        {
                            "columnMatch": "Unique Sessions",
                            "formatter": 3,
                            "formatOptions": {
                                "min": 0,
                                "palette": "green",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        },
                        {
                            "columnMatch": "Total Instances",
                            "formatter": 3,
                            "formatOptions": {
                                "min": 0,
                                "palette": "orange",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        }
                    ],
                    "filter": true
                }
            },
            "conditionalVisibility": null,
            "alwaysShowPin": true
        },
        {
            "type": 1,
            "content": {
                "json": "## <a name=\"trend-of-active-users\"></a><span data-ttu-id=\"a16ec-109\">æ´»åŠ¨ç”¨æˆ·çš„è¶‹åŠ¿</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-109\">Trend of Active Users</span></span>\n<span data-ttu-id=\"a16ec-110\">ä»ä¸Šè¡¨ä¸­é€‰æ‹©ä¸€è¡Œï¼ŒæŸ¥çœ‹è¯¥é¡¹çš„å½“å‰ä½¿ç”¨æƒ…å†µå˜åŒ–ã€‚</span><span class=\"sxs-lookup\"><span data-stu-id=\"a16ec-110\">Select a row from the table above to see changes in active usage for that item.</span></span>"
            },
            "conditionalVisibility": null
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "232e6104-dba9-4c57-88ac-1962aeb15287",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                            "durationMs": 2592000000
                        },
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "selectableValues": [
                                {
                                    "durationMs": 604800000
                                },
                                {
                                    "durationMs": 1209600000
                                },
                                {
                                    "durationMs": 2592000000
                                },
                                {
                                    "durationMs": 5184000000
                                },
                                {
                                    "durationMs": 7776000000
                                }
                            ]
                        },
                        "timeContextFromParameter": null
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let ts = {TimeRange:end} - {TimeRange:start};\r\nlet start = startofday(ago(ts + {Metric}));\r\nunion customEvents, pageViews\r\n| where timestamp >= start\r\n| where name in ({Activities}) or '*' in ({Activities}) or ('%' in ({Activities}) and itemType == 'pageView') or ('#' in ({Activities}) and itemType == 'customEvent')\r\n{OtherFilters}\r\n| where '{Filter}' == 'All events' or '{Filter}' == 'ğŸ”¸ Overall' or {SplitBy} == '{Filter}'\r\n| evaluate activity_engagement(user_Id, timestamp, start, now(), 1d, {Metric})\r\n| where timestamp >= startofday(ago(ts))\r\n| project timestamp, [\"{Filter}\"] = dcount_activities_outer\r\n| render timechart ",
                "showQuery": false,
                "size": 0,
                "aggregation": 5,
                "showAnnotations": false,
                "showAnalytics": true,
                "color": "blue",
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "areachart"
            },
            "conditionalVisibility": null,
            "alwaysShowPin": true
        }
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}