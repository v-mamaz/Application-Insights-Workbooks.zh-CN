{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 1,
            "content": {
                "json": "## <a name=\"apdex\"></a><span data-ttu-id=\"6d6a3-101\">Apdex</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-101\">Apdex</span></span>\n\n<span data-ttu-id=\"6d6a3-102\">[Apdex（应用程序性能指数）](http://apdex.org/overview.html)是用于测量应用程序性能的开放式标准方法。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-102\">[Apdex (Application Performance Index)](http://apdex.org/overview.html) is an open standard method for measuring application performance.</span></span> <span data-ttu-id=\"6d6a3-103\">它将应用程序的性能与提供给用户的体验质量相关联。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-103\">It contextualizes your application's performance in terms of the quality of experience you provide to your users.</span></span>\n\n<span data-ttu-id=\"6d6a3-104\">Apdex 根据为应用定义的基线性能阈值 T 将性能分为三个区域：</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-104\">Apdex classifies performance into three zones based on a baseline performance threshold T you define for your app:</span></span>\n\n<span data-ttu-id=\"6d6a3-105\">| 区域 | 最小响应时间 | 最大响应时间 | | --- |: --- |: --- |: --- | | 满足 | 0 秒 | T 秒 | | 承受 | T 秒 | 4T 秒 | | 挫败 | 4T 秒 | - |</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-105\">| Zone | Minimum Response Time | Maximum Response Time | | --- |: --- |: --- |: --- | | Satisfied | 0 seconds | T seconds | | Tolerating | T seconds | 4T seconds | | Frustrated | 4T seconds | - |</span></span>\n"
            },
            "conditionalVisibility": null
        },
        {
            "type": 1,
            "content": {
                "json": "### <a name=\"apdex-parameters\"></a><span data-ttu-id=\"6d6a3-106\">Apdex 参数</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-106\">Apdex Parameters</span></span>"
            },
            "conditionalVisibility": null
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "f3e68c23-278e-4175-815d-dc7961bf34a0",
                        "version": "KqlParameterItem/1.0",
                        "name": "Type",
                        "type": 2,
                        "description": null,
                        "isRequired": true,
                        "multiSelect": null,
                        "query": "datatable( column1:string, column2:string ) \r\n[ \r\n\"union pageViews, requests, dependencies\", \"Page Views, Requests and Dependencies\", \r\n\"union pageViews, requests\", \"Page Views and Requests\", \r\n\"pageViews\", \"Page Views\", \r\n\"requests\", \"Requests\", \r\n\"dependencies\", \"Dependencies\", \r\n] ",
                        "isHiddenWhenLocked": false,
                        "value": "pageViews"
                    },
                    {
                        "id": "07a9044c-0e5d-40f2-b815-b002fdcf5220",
                        "version": "KqlParameterItem/1.0",
                        "name": "Operations",
                        "type": 2,
                        "description": "<span data-ttu-id=\"6d6a3-107\">逗号分隔的项列表，包含在 Apdex 计算中。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-107\">Comma seperated list of items to include in Apdex calculations.</span></span> <span data-ttu-id=\"6d6a3-108\">示例：“RequestA”、“RequestB”、“PageViewC”。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-108\">example: 'RequestA', 'RequestB', 'PageViewC'.</span></span> <span data-ttu-id=\"6d6a3-109\">使用“\\*”包括全部</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-109\">Use '\\*' to include all</span></span>",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "{Type}\n| where timestamp >= ago(7d)\n| summarize count() by name\n| order by count_ desc\n| project Id=name, Title=name, Selected=false\n| union (\ndatatable(Id:string, Title:string, Selected:boolean)[\n'*', 'All Operations', true\n]\n)"
                    },
                    {
                        "id": "9e8aba54-518d-443e-9eaf-4c8e87d513be",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                            "durationMs": 86400000
                        },
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "selectableValues": [
                                {
                                    "durationMs": 1800000
                                },
                                {
                                    "durationMs": 3600000
                                },
                                {
                                    "durationMs": 14400000
                                },
                                {
                                    "durationMs": 43200000
                                },
                                {
                                    "durationMs": 86400000
                                },
                                {
                                    "durationMs": 172800000
                                },
                                {
                                    "durationMs": 259200000
                                },
                                {
                                    "durationMs": 604800000
                                },
                                {
                                    "durationMs": 1209600000
                                },
                                {
                                    "durationMs": 2592000000
                                }
                            ],
                            "allowCustom": true
                        },
                        "timeContextFromParameter": null
                    },
                    {
                        "id": "e2d47629-1167-4d8b-bd88-3f5641e6d484",
                        "version": "KqlParameterItem/1.0",
                        "name": "OperationsFilter",
                        "type": 1,
                        "description": null,
                        "isRequired": false,
                        "isHiddenWhenLocked": false,
                        "value": ""
                    },
                    {
                        "id": "822d691d-da84-46c8-84de-e2b091fb8387",
                        "version": "KqlParameterItem/1.0",
                        "name": "ApdexThresholdInMilliseconds",
                        "type": 1,
                        "description": "<span data-ttu-id=\"6d6a3-110\">需要在 Apdex 计算中使用的阈值。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-110\">The threshold to use in Apdex calculations.</span></span> <span data-ttu-id=\"6d6a3-111\">它默认为所选活动的平均操作持续时间。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-111\">It defaults to the average operation duration for the select activities.</span></span>",
                        "isRequired": true,
                        "query": "{Type}\n| where timestamp {TimeRange}\n| where name in ({Operations}) or '*' in ({Operations})\n| summarize SumOfDuration =  sum(duration), CountOfDuration = count()\n| project AverageDuration = round(iff(CountOfDuration == 0, 0.0, 1.0 * SumOfDuration / CountOfDuration))\n",
                        "isHiddenWhenLocked": false,
                        "timeContextFromParameter": null,
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                    },
                    {
                        "id": "17ac059b-c7b6-498c-81b8-23c3213f38ee",
                        "version": "KqlParameterItem/1.0",
                        "name": "Calculations",
                        "type": 2,
                        "description": null,
                        "isRequired": true,
                        "multiSelect": null,
                        "query": "datatable(x: string, y: string) [\r\n'ConsiderFailures', 'Consider failures as frustrating', \r\n'DoNotConsiderFailures', 'Do not consider failures as frustrating'\r\n]",
                        "value": "ConsiderFailures"
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": null
        },
        {
            "type": 1,
            "content": {
                "json": "<span data-ttu-id=\"6d6a3-112\">`ApdexThresholdInMilliseconds` 默认为所选操作的平均持续时间。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-112\">`ApdexThresholdInMilliseconds` defaults to the average duration for the selected operations.</span></span> <span data-ttu-id=\"6d6a3-113\">将此设置为适合应用的阈值。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-113\">Set this to a threshold that makes sense for your app.</span></span>\n\n### <a name=\"drill-in-parameters\"></a><span data-ttu-id=\"6d6a3-114\">钻取参数</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-114\">Drill-in parameters</span></span>"
            },
            "conditionalVisibility": null
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "query": "",
                "crossComponentResources": [],
                "parameters": [
                    {
                        "id": "2f57173e-c1de-4b51-90a6-fc4baee9fec6",
                        "version": "KqlParameterItem/1.0",
                        "name": "SplitBy",
                        "type": 2,
                        "isRequired": true,
                        "query": "datatable(value:string, text:string)[\r\n'name', '⚪ Activity Name',\r\n'cloud_RoleInstance', '🖥️ Machine',\r\n'client_CountryOrRegion', '📍 Country or Region',\r\n'client_StateOrProvince', '📍 State or Province',\r\n'application_Version', '⚪ Application Version',\r\n'operation_Name', '⚪ Operation',\r\n]\r\n| union ({Type}\r\n| where timestamp {TimeRange}\r\n| where name in ({Operations}) or '*' in ({Operations})\r\n| project customDimensions \r\n| summarize schema = buildschema(customDimensions) \r\n| mvexpand schema\r\n| extend e = extract(@'{\"(.+)\":.+}', 1, tostring(schema))\r\n| project text = strcat('❄️ ', e), value = strcat('customDimensions[\"', e, '\"]'))",
                        "value": "name",
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContextFromParameter": null,
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                    },
                    {
                        "id": "6d8ec5b4-d1a7-45a0-9703-870eea3fad3d",
                        "version": "KqlParameterItem/1.0",
                        "name": "OrderBy",
                        "type": 2,
                        "isRequired": true,
                        "query": "datatable(value:string, text:string)[\r\n'Relevance desc', 'Most Relevant',\r\n'[\"Apdex Score\"] desc', 'Highest Apdex',\r\n'[\"Apdex Score\"] asc', 'Lowest Apdex',\r\n'Users desc', 'Most Users',\r\n]",
                        "value": "Relevance desc",
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContextFromParameter": null,
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                    },
                    {
                        "id": "dd476d22-f17b-4ad9-ad00-e5d0cf73fe25",
                        "version": "KqlParameterItem/1.0",
                        "name": "SegmentFilters",
                        "type": 2,
                        "isRequired": false,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "{Type}\r\n| where timestamp {TimeRange}\r\n| where name in ({Operations}) or '*' in ({Operations})\r\n| extend Dim = iff(isempty({SplitBy})== true, 'Unknown', {SplitBy})\r\n| summarize by Value = Dim, Name = Dim\r\n| extend isDefault = false\r\n| order by Name asc\r\n| union (datatable(Value:string, Name:string, isDefault:boolean)[ '*', 'Include All', true])\r\n",
                        "isHiddenWhenLocked": false,
                        "typeSettings": {
                            "additionalResourceOptions": []
                        },
                        "timeContextFromParameter": null,
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                    }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.insights/components"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let apdexThreshhold = toint('{ApdexThresholdInMilliseconds}');\r\nlet apdexData = {Type}\r\n| where timestamp {TimeRange}\r\n| where name in ({Operations}) or '*' in ({Operations})\r\n{OperationsFilter}\r\n| extend success = columnifexists('success', true)\r\n| extend Failure = iff('{Calculations}' == 'ConsiderFailures' and success == false, 1, 0)\r\n| extend InterestingDimension = iff(isempty({SplitBy})== true, 'Unknown', {SplitBy})\r\n| where InterestingDimension in ({SegmentFilters}) or '*' in ({SegmentFilters})\r\n| summarize AverageDuration = avg(duration), Failures = sum(Failure) by user_Id\r\n| extend UserExperience = case(AverageDuration <= apdexThreshhold, 'Satisfied', AverageDuration <= 4 * apdexThreshhold, 'Tolerating', 'Frustrated')\r\n| extend UserExperience = case(Failures > 0, \"Frustrated\", UserExperience)\r\n| summarize Satisfied = countif(UserExperience == 'Satisfied'), Tolerating = countif(UserExperience == 'Tolerating'), Frustrated = countif(UserExperience == 'Frustrated'), Total = count()\r\n| project Satisfied, Tolerating, Frustrated, ApdexScore = round((Satisfied + (Tolerating / 2.0)) / Total, 2);\r\napdexData\r\n//| extend [\"Apdex Interpretation\"] = case([\"Apdex Score\"] <= 0.5, '⛔ Unacceptable', [\"Apdex Score\"] <= 0.7, '⚠️ Poor', [\"Apdex Score\"] <= 0.85, '⚠️ Fair', [\"Apdex Score\"] <= 0.94, '✔️ Good', '✔️ Excellent')\r\n| evaluate narrow()\r\n| extend Value = toreal(Value)\r\n| project Name = case(Column == 'Satisfied', 'Satisfied Users', Column == 'Tolerating', 'Tolerating Users', Column == 'Frustrated', 'Frustrated Users', 'Apdex Score'), Value, Rank = case(Column == 'Satisfied', 2, Column == 'Tolerating', 3, Column == 'Frustrated', 4, 1), Interperation = iff(Column == 'ApdexScore', case(Value <= 0.5, '⛔ Unacceptable', Value <= 0.7, '⚠️ Poor', Value <= 0.85, '⚠️ Fair', Value <= 0.94, '✔️ Good', '✔️ Excellent'), '')\r\n| order by Rank asc",
                "showQuery": false,
                "size": 3,
                "aggregation": 0,
                "showAnnotations": false,
                "showAnalytics": false,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "tiles",
                "tileSettings": {
                    "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                            "showIcon": true
                        },
                        "numberFormat": {
                            "unit": 0,
                            "options": {
                                "style": "decimal"
                            }
                        }
                    },
                    "secondaryContent": {
                        "columnMatch": "Interperation",
                        "formatter": 1,
                        "formatOptions": {
                            "showIcon": true
                        }
                    },
                    "showBorder": false
                }
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let apdexThreshhold = toint('{ApdexThresholdInMilliseconds}');\nlet apdexData = {Type}\n| where timestamp {TimeRange}\n| where name in ({Operations}) or '*' in ({Operations})\n{OperationsFilter}\n| extend success = columnifexists('success', true)\n| extend Failure = iff('{Calculations}' == 'ConsiderFailures' and success == false, 1, 0)\n| extend InterestingDimension = iff(isempty({SplitBy})== true, 'Unknown', {SplitBy})\n| where InterestingDimension in ({SegmentFilters}) or '*' in ({SegmentFilters})\n| summarize AverageDuration = avg(duration), Failures = sum(Failure) by user_Id, InterestingDimension\n| extend UserExperience = case(AverageDuration <= apdexThreshhold, 'Satisfied', AverageDuration <= 4 * apdexThreshhold, 'Tolerating', 'Frustrated')\n| extend UserExperience = case(Failures > 0, \"Frustrated\", UserExperience)\n| summarize Satisfied = countif(UserExperience == 'Satisfied'), Tolerating = countif(UserExperience == 'Tolerating'), Frustrated = countif(UserExperience == 'Frustrated'), Total = count() by InterestingDimension\n| project InterestingDimension, [\"Satisfied Users\"] = Satisfied, [\"Tolerating Users\"] = Tolerating, [\"Frustrated Users\"] = Frustrated, [\"Apdex Score\"] = round((Satisfied + (Tolerating / 2.0)) / Total, 2), Total\n| extend Relevance = iff([\"Apdex Score\"] == 0, pow(Total, 1.6), Total / [\"Apdex Score\"])\n| project-rename Users = Total\n| order by {OrderBy}\n| project-away Users, Relevance;\napdexData\n| extend [\"Apdex Interpretation\"] = case([\"Apdex Score\"] <= 0.5, '⛔ Unacceptable', [\"Apdex Score\"] <= 0.7, '⚠️ Poor', [\"Apdex Score\"] <= 0.85, '⚠️ Fair', [\"Apdex Score\"] <= 0.94, '✔️ Good', '✔️ Excellent')\n| project Values = InterestingDimension, [\"Apdex Score\"], [\"Apdex Interpretation\"], [\"Satisfied Users\"], [\"Tolerating Users\"], [\"Frustrated Users\"]\n",
                "showQuery": false,
                "size": 0,
                "aggregation": 0,
                "showAnnotations": false,
                "showAnalytics": true,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "Apdex Score",
                            "formatter": 3,
                            "formatOptions": {
                                "min": 0,
                                "max": 1,
                                "palette": "blue",
                                "showIcon": true
                            }
                        },
                        {
                            "columnMatch": "Satisfied",
                            "formatter": 8,
                            "formatOptions": {
                                "min": 0,
                                "palette": "green",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        },
                        {
                            "columnMatch": "Tolerating Users",
                            "formatter": 8,
                            "formatOptions": {
                                "min": 0,
                                "palette": "yellow",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        },
                        {
                            "columnMatch": "Frustrated Users",
                            "formatter": 8,
                            "formatOptions": {
                                "min": 0,
                                "palette": "red",
                                "showIcon": true
                            },
                            "numberFormat": {
                                "unit": 17,
                                "options": {
                                    "style": "decimal"
                                }
                            }
                        }
                    ],
                    "filter": true
                }
            },
            "conditionalVisibility": null,
            "alwaysShowPin": true
        },
        {
            "type": 1,
            "content": {
                "json": "# <a name=\"daily-apdex-score\"></a><span data-ttu-id=\"6d6a3-115\">每日 Apdex 得分</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-115\">Daily Apdex Score</span></span>\n<span data-ttu-id=\"6d6a3-116\">请参阅 Apdex 得分如何随时间变化。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-116\">See how your Apdex Score changes over time.</span></span>"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let apdexThreshhold = toint('{ApdexThresholdInMilliseconds}');\nlet failureThreshhold = 1;\nlet apdexData = {Type}\n| where timestamp {TimeRange}\n| where name in ({Operations}) or '*' in ({Operations})\n{OperationsFilter}\n| extend success = columnifexists('success', true)\n| extend Failure = iff('{Calculations}' == 'ConsiderFailures' and success == false, 1, 0)\n| extend InterestingDimension = iff(isempty({SplitBy})== true, 'Unknown', {SplitBy})\n| where InterestingDimension in ({SegmentFilters}) or '*' in ({SegmentFilters})\n| summarize AverageDuration = avg(duration), Failures = sum(Failure) by user_Id, bin(timestamp, {TimeRange:grain}), InterestingDimension\n| extend UserExperience = case(AverageDuration <= apdexThreshhold, 'Satisfied', AverageDuration <= 4 * apdexThreshhold, 'Tolerating', 'Frustrated')\n| extend UserExperience = case(Failures >= failureThreshhold, \"Frustrated\", UserExperience)\n| summarize Satisfied = countif(UserExperience == 'Satisfied'), Tolerating = countif(UserExperience == 'Tolerating'), Total = count() by timestamp, InterestingDimension\n| project timestamp, ApdexScore = (Satisfied + (Tolerating / 2.0)) / Total, Users = Total, InterestingDimension;\nlet pageRelevance = apdexData\n| summarize [\"Apdex Score\"] = avg(ApdexScore), Users=sum(Users) by InterestingDimension\n| extend Relevance = iff([\"Apdex Score\"] == 0, 1.0 * Users * Users, Users / [\"Apdex Score\"])\n| order by {OrderBy}\n| project InterestingDimension\n| take 7;\napdexData\n| join kind = leftouter (pageRelevance) on InterestingDimension\n| extend InterestingDimension = iff(isempty(InterestingDimension1) == true, 'Other', InterestingDimension)\n| project timestamp, ApdexScore, Users, InterestingDimension \n| summarize ApdexScore = avg(ApdexScore) by timestamp, InterestingDimension\n| extend ApdexScore = round(ApdexScore, 3)",
                "showQuery": false,
                "size": 0,
                "aggregation": 5,
                "showAnnotations": false,
                "showAnalytics": false,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "timechart"
            },
            "conditionalVisibility": null
        },
        {
            "type": 1,
            "content": {
                "json": "# <a name=\"daily-quality-trend\"></a><span data-ttu-id=\"6d6a3-117\">每日质量趋势</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-117\">Daily Quality Trend</span></span>\n<span data-ttu-id=\"6d6a3-118\">请参阅用户的性能体验随时间的变化情况。</span><span class=\"sxs-lookup\"><span data-stu-id=\"6d6a3-118\">See your how the performance experience of your users have changed over time.</span></span>"
            },
            "conditionalVisibility": null
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let apdexThreshhold = toint('{ApdexThresholdInMilliseconds}');\nlet failureThreshhold = 1;\n{Type}\n| where timestamp {TimeRange}\n| where name in ({Operations}) or '*' in ({Operations})\n{OperationsFilter}\n| extend success = columnifexists('success', true)\n| extend Failure = iff('{Calculations}' == 'ConsiderFailures' and success == false, 1, 0)\n| extend InterestingDimension = iff(isempty({SplitBy})== true, 'Unknown', {SplitBy})\n| where InterestingDimension in ({SegmentFilters}) or '*' in ({SegmentFilters})\n| summarize AverageDuration = avg(duration), Failures = sum(Failure) by user_Id, bin(timestamp, {TimeRange:grain})\n| extend UserExperience = case(AverageDuration <= apdexThreshhold, 'Satisfied', AverageDuration <= 4 * apdexThreshhold, 'Tolerating', 'Frustrated')\n| extend UserExperience = case(Failures >= failureThreshhold, \"Frustrated\", UserExperience)\n| summarize count() by UserExperience, timestamp",
                "showQuery": false,
                "size": 0,
                "aggregation": 5,
                "showAnnotations": false,
                "showAnalytics": false,
                "timeContextFromParameter": null,
                "queryType": 0,
                "resourceType": "microsoft.insights/components",
                "visualization": "barchart"
            },
            "conditionalVisibility": null
        }
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}